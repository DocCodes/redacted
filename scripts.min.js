/*
 Evan Young 2017
 @file      An engine written for a browser
*/
var $jscomp={scope:{}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(a,c,d){if(d.get||d.set)throw new TypeError("ES3 does not support getters and setters.");a!=Array.prototype&&a!=Object.prototype&&(a[c]=d.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.symbolCounter_=0;$jscomp.Symbol=function(a){return $jscomp.SYMBOL_PREFIX+(a||"")+$jscomp.symbolCounter_++};
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.iterator;a||(a=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[a]&&$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(a){var c=0;return $jscomp.iteratorPrototype(function(){return c<a.length?{done:!1,value:a[c++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(a){$jscomp.initSymbolIterator();a={next:a};a[$jscomp.global.Symbol.iterator]=function(){return this};return a};$jscomp.makeIterator=function(a){$jscomp.initSymbolIterator();var c=a[Symbol.iterator];return c?c.call(a):$jscomp.arrayIterator(a)};Location.prototype.query=function(){for(var a=document.location.search.split("+").join(" "),c=/[?&]?([^=]+)=([^&]*)/g,d={},f;f=c.exec(a);)d[decodeURIComponent(f[1])]=decodeURIComponent(f[2]);return d}();
Number.prototype.clamp=function(a,c){return Math.min(Math.max(this,void 0===a?0:a),void 0===c?1E6:c)};
var ROM={author:"Evan Young",copyright:"Copyright (c) Evan Young 2017",version:"1.1.17",date:"12/14/2017",W:320,H:200,FPS:30,PALETTE:{BLACK:"#000000",WHITE:"#FFFFFF",RED:"#880000",CYAN:"#AAFFEE",VIOLET:"#CC44CC",GREEN:"#00CC55",BLUE:"#0000AA",YELLOW:"#EEEE77",ORANGE:"#DD8855",BROWN:"#664400",LRED:"#FF7777",DGREY:"#333333",GREY:"#777777",LGREEN:"#AAFF66",LBLUE:"#0088FF",LGREY:"#BBBBBB"},Graphics:{Icon:function(a,c,d,f,e,g,h){d=void 0===d?ROM.PALETTE.BLACK:d;e=void 0===e?"tl":e;g=void 0===g?Math.ceil(ROM.W/
2):g;h=void 0===h?Math.ceil(ROM.H/2):h;this.ord=a;this.icon=c;this.color=d;this.scale=void 0===f?1:f;this.pos={x:g,y:h+.5};switch(c){case "que":switch(e){case "cc":this.pos.x-=Math.ceil(3.5*this.scale),this.pos.y-=Math.ceil(5*this.scale)}this.draw=function(){ctx.fillStyle=this.color;ctx.strokeStyle=this.color;ctx.lineWidth=this.scale;ctx.fillRect(this.pos.x+1*this.scale,this.pos.y+.5,5*this.scale,2*this.scale);ctx.fillRect(this.pos.x,this.pos.y+.5+1*this.scale,2*this.scale,3*this.scale);ctx.fillRect(this.pos.x+
5*this.scale,this.pos.y+.5+1*this.scale,2*this.scale,4*this.scale);ctx.fillRect(this.pos.x+4*this.scale,this.pos.y+.5+4*this.scale,this.scale,this.scale);ctx.fillRect(this.pos.x+3*this.scale,this.pos.y+.5+5*this.scale,2*this.scale,2*this.scale);ctx.fillRect(this.pos.x+3*this.scale,this.pos.y+.5+8*this.scale,2*this.scale,2*this.scale)};break;case "floppy":switch(e){case "cc":this.pos.x-=Math.ceil(13.5*this.scale),this.pos.y-=Math.ceil(13.5*this.scale)}this.draw=function(){var a=this.pos.x+this.scale,
b=this.pos.y+(this.scale+1)%2*.5;ctx.fillStyle=this.color;ctx.strokeStyle=this.color;ctx.lineWidth=this.scale;ctx.beginPath();ctx.moveTo(a,b);a+=23*this.scale;ctx.lineTo(a,b);ctx.fillRect(a,b+.5*this.scale,this.scale,this.scale);ctx.fillRect(a+this.scale,b+1.5*this.scale,this.scale,this.scale);a+=3*this.scale-.5*this.scale;b+=3*this.scale-.5*this.scale;ctx.moveTo(a,b);b+=23*this.scale;ctx.lineTo(a,b);a-=this.scale-.5*this.scale;b+=this.scale-.5*this.scale;ctx.moveTo(a,b);a-=25*this.scale;ctx.lineTo(a,
b);a-=this.scale-.5*this.scale;b-=this.scale-.5*this.scale;ctx.moveTo(a,b);b-=25*this.scale;ctx.lineTo(a,b);a+=4*this.scale;b+=26*this.scale;ctx.moveTo(a,b);b-=12*this.scale;ctx.lineTo(a,b);a+=1*this.scale-.5*this.scale;b-=1*this.scale-.5*this.scale;ctx.moveTo(a,b);a+=17*this.scale;ctx.lineTo(a,b);a+=1*this.scale-.5*this.scale;b+=1*this.scale-.5*this.scale;ctx.moveTo(a,b);b+=12*this.scale;ctx.lineTo(a,b);a=this.pos.x+7*this.scale-.5*this.scale;b=this.pos.y+.5*this.scale;ctx.moveTo(a,b);b+=8*this.scale;
ctx.lineTo(a,b);a+=1*this.scale-.5*this.scale;b+=1*this.scale-.5*this.scale;ctx.moveTo(a,b);a+=13*this.scale;ctx.lineTo(a,b);a+=1*this.scale-.5*this.scale;b-=1*this.scale-.5*this.scale;ctx.moveTo(a,b);b-=8*this.scale;ctx.lineTo(a,b);a-=3*this.scale;b+=2*this.scale;ctx.moveTo(a,b);b+=4*this.scale;ctx.lineTo(a,b);a-=1*this.scale-.5*this.scale;b+=1*this.scale-.5*this.scale;ctx.moveTo(a,b);a-=3*this.scale;ctx.lineTo(a,b);a-=1*this.scale-.5*this.scale;b-=1*this.scale-.5*this.scale;ctx.moveTo(a,b);b-=4*
this.scale;ctx.lineTo(a,b);a+=1*this.scale-.5*this.scale;b-=1*this.scale-.5*this.scale;ctx.moveTo(a,b);a+=3*this.scale;ctx.lineTo(a,b);ctx.stroke()}}},Projectile:function(a,c,d,f,e,g){this.ord=a;this.color=c;this.pos=f;this.draw=d;this.motion=e;this.persist=void 0===g?!1:g},Entity:function(a,c,d,f,e){f=void 0===f?{x:Math.ceil(ROM.W/2),y:Math.ceil(.8*ROM.H)}:f;e=void 0===e?{}:e;this.ord=a;this.color=c;this.pos=f;this.draw=d;for(var g in e)e.hasOwnProperty(g)&&(this[g]=e[g])},Layer:function(a,c){this.ord=
a;this.draw=c},Border:function(a,c,d){d=void 0===d?ROM.PALETTE.WHITE:d;this.width=2*(void 0===c?4:c);this.color=d;this.ord=a;this.draw=function(){ctx.strokeStyle=this.color;ctx.lineWidth=this.width;ctx.strokeRect(0,0,ROM.W,ROM.H)}}},keyPress:function(a){},keyUp:function(a){RAM.ctape+=a.key.toLowerCase();"KeyH"===a.code&&a.altKey&&(document.location.search="");void 0!==RAM.keyUp&&RAM.keyUp(a)},keyDown:function(a){void 0!==RAM.keyDown&&RAM.keyDown(a)},loadCartridge:function(){if("internal"===document.location.query.loc){var a=
document.createElement("script");a.src="disc/"+document.location.query.cart+".js";document.head.append(a)}},registerCartridge:function(){document.title="Optical - "+RAM.cart.title;void 0!==RAM.tick&&setInterval(RAM.tick,1E3/60);setInterval(ROM.drawLayers,1E3/ROM.FPS)},drawLayers:function(){var a=[],c;for(c in RAM.layers)a.push([c,RAM.layers[c].ord]);a.sort(function(a,c){return a[1]-c[1]});a=$jscomp.makeIterator(a);for(c=a.next();!c.done;c=a.next())if(c=c.value,Array.isArray(RAM.layers[c[0]])){c=$jscomp.makeIterator(RAM.layers[c[0]]);
for(var d=c.next();!d.done;d=c.next())ly=d.value,ly.draw()}else RAM.layers[c[0]].draw()}};Object.freeze(ROM);var RAM={layers:{},cart:{},ctape:""};function bootSequence(){window.canvas=document.getElementById("mainCanvas");window.ctx=canvas.getContext("2d");window.ctx.imageSmoothingEnabled=!1;void 0===document.location.query.cart&&(window.location.search="?cart=disc&loc=internal");ROM.loadCartridge()}document.onkeypress=ROM.keyPress;document.onkeyup=ROM.keyUp;document.onkeydown=ROM.keyDown;
